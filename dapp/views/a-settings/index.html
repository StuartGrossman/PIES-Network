<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>AdSpace</title>
  <link rel="stylesheet" type="text/css" href="../sources/css/bootstrap.min.css">
  <!-- Bootstrap Core CSS -->
    <link href="../sources/css/bootstrap-extension.css" rel="stylesheet">
    <!-- Menu CSS -->
    <link href="../sources/css/sidebar-nav.min.css" rel="stylesheet">
    <!-- toast CSS -->
    <link href="../sources/css/jquery.toast.css" rel="stylesheet">
    <!-- morris CSS -->
    <link href="../sources/css/morris.css" rel="stylesheet">
    <!-- animation CSS -->
    <link href="../sources/css/animate.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../sources/css/admin-style.css" rel="stylesheet">
    <!-- color CSS -->
    <link href="../sources/css/default-dark.css" id="theme" rel="stylesheet">
    <link href="../sources/css/spinners.css" />
    <link href="../sources/css/custom.css" rel="stylesheet" />
</head>




<body>
  <div id="wrapper" class="main-container">
      <!-- Navigation -->
      <nav class="navbar navbar-default navbar-static-top m-b-0">
          <div class="navbar-header">
             <a class="navbar-toggle hidden-sm hidden-md hidden-lg " href="javascript:void(0)" data-toggle="collapse" data-target=".navbar-collapse"><i class="ti-menu"></i></a>
               <a class="logo" href="/">
                 <b>
                   <img src="../sources/images/content-logo.png" style="width:150%" />
                 </b>
               </a>

              <ul class="nav navbar-top-links navbar-left hidden-xs">
                  <li><a href="javascript:void(0)" class="open-close hidden-xs waves-effect waves-light"><i class="icon-arrow-left-circle ti-menu"></i></a></li>
                  <li>
                      <!-- <form role="search" class="app-search hidden-xs"> -->
                          <!-- <input type="text" placeholder="Search..." class="form-control"> <a href=""><i class="fa fa-search"></i></a> </form> -->

                  </li>

              </ul>
              <ul class="nav navbar-top-links navbar-right pull-right">
                <li><a href="/a-transactions" class="waves-effect"><i class="fa fa-circle-o text-info"></i>
                  <span class="hide-menu" id="balance"><i>none</i></span>
                  <div class="notify"><span class="heartbit">
                    </span><span class="point"></span>
                  </div></a>
                </li>

                  <li class="dropdown">
                     <!-- <a class="dropdown-toggle waves-effect waves-light" data-toggle="dropdown" href="/a-ads"><i class="icon-envelope">
                     </i>
                          <div class="notify"><span class="heartbit">
                            </span><span class="point"></span>
                          </div>
                      </a> -->

                      <!-- <ul class="dropdown-menu mailbox animated bounceInDown">
                          <li>
                              <div class="drop-title">You have 4 new messages</div>
                          </li>
                          <li>
                              <div class="message-center">
                                  <a href="#">
                                      <div class="user-img"> <img src="../sources/images/pawandeep.jpg" alt="user" class="img-circle"> <span class="profile-status online pull-right"></span> </div>
                                      <div class="mail-contnet">
                                          <h5>Pavan kumar</h5> <span class="mail-desc">Just see the my admin!</span> <span class="time">9:30 AM</span> </div>
                                  </a>
                                  <a href="#">
                                      <div class="user-img"> <img src="../sources/images/sonu.jpg" alt="user" class="img-circle"> <span class="profile-status busy pull-right"></span> </div>
                                      <div class="mail-contnet">
                                          <h5>Sonu Nigam</h5> <span class="mail-desc">I've sung a song! See you at</span> <span class="time">9:10 AM</span> </div>
                                  </a>
                                  <a href="#">
                                      <div class="user-img"> <img src="../sources/images/arijit.jpg" alt="user" class="img-circle"> <span class="profile-status away pull-right"></span> </div>
                                      <div class="mail-contnet">
                                          <h5>Arijit Sinh</h5> <span class="mail-desc">I am a singer!</span> <span class="time">9:08 AM</span> </div>
                                  </a>
                                  <a href="#">
                                      <div class="user-img"> <img src="../sources/images/pawandeep.jpg" alt="user" class="img-circle"> <span class="profile-status offline pull-right"></span> </div>
                                      <div class="mail-contnet">
                                          <h5>Pavan kumar</h5> <span class="mail-desc">Just see the my admin!</span> <span class="time">9:02 AM</span> </div>
                                  </a>
                              </div>
                          </li>
                          <li>
                              <a class="text-center" href="javascript:void(0);"> <strong>See all notifications</strong> <i class="fa fa-angle-right"></i> </a>
                          </li>
                      </ul> -->
                      <!-- /.dropdown-messages -->
                  </li>
                  <!-- /.dropdown -->
                  <li class="dropdown"> <a class="dropdown-toggle waves-effect waves-light" data-toggle="dropdown" href="/a-upload"><i class="icon-note"></i>
                  <div class="notify"><span class="heartbit"></span><span class="point"></span></div>
                  </a>
                      <ul class="dropdown-menu dropdown-tasks animated slideInUp">
                          <li>
                              <a href="#">
                                  <div>
                                      <p> <strong>Task 1</strong> <span class="pull-right text-muted">40% Complete</span> </p>
                                      <div class="progress progress-striped active">
                                          <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%"> <span class="sr-only">40% Complete (success)</span> </div>
                                      </div>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <a href="#">
                                  <div>
                                      <p> <strong>Task 2</strong> <span class="pull-right text-muted">20% Complete</span> </p>
                                      <div class="progress progress-striped active">
                                          <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%"> <span class="sr-only">20% Complete</span> </div>
                                      </div>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <a href="#">
                                  <div>
                                      <p> <strong>Task 3</strong> <span class="pull-right text-muted">60% Complete</span> </p>
                                      <div class="progress progress-striped active">
                                          <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%"> <span class="sr-only">60% Complete (warning)</span> </div>
                                      </div>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <a href="#">
                                  <div>
                                      <p> <strong>Task 4</strong> <span class="pull-right text-muted">80% Complete</span> </p>
                                      <div class="progress progress-striped active">
                                          <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%"> <span class="sr-only">80% Complete (danger)</span> </div>
                                      </div>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <a class="text-center" href="#"> <strong>See All Tasks</strong> <i class="fa fa-angle-right"></i> </a>
                          </li>
                      </ul>
                      <!-- /.dropdown-tasks -->
                  </li>

              </ul>
          </div>

      </nav>
      <!-- Left navbar-header -->
      <div class="navbar-default sidebar" role="navigation">
          <div class="sidebar-nav navbar-collapse slimscrollsidebar">
              <div class="user-profile">
                  <div class="dropdown user-pro-body">
                      <div><img id="userImage" alt="user-img" class="img-circle"></div> <a href="#" class="dropdown-toggle u-dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="userName"><span class="caret"></span></a>
                      <!-- <ul class="dropdown-menu animated flipInY">
                          <li><a href="#"><i class="ti-user"></i> My Profile</a></li>
                          <li><a href="#"><i class="ti-wallet"></i> My Balance</a></li>
                          <li><a href="#"><i class="ti-email"></i> Inbox</a></li>
                          <li role="separator" class="divider"></li>
                          <li><a href="#"><i class="ti-settings"></i> Account Setting</a></li>
                          <li role="separator" class="divider"></li>
                          <li><a href="login.html"><i class="fa fa-power-off"></i> Logout</a></li>
                      </ul> -->
                  </div>
              </div>
              <ul class="nav" id="side-menu">
                  <li class="sidebar-search hidden-sm hidden-md hidden-lg">
                      <!-- input-group -->
                      <!-- <div class="input-group custom-search-form">
                          <input type="text" class="form-control" placeholder="Search..."> <span class="input-group-btn">
                            <button class="btn btn-default" type="button"> <i class="fa fa-search"></i> </button>
                          </span> </div> -->
                      <!-- /input-group -->
                  </li>
                  <!-- <li class="nav-small-cap m-t-10"> Main Menu</li> -->
                  <li>
                    <a href="index.html" class="waves-effect active"><i class="linea-icon linea-basic fa-fw" data-icon="v">
                    </i>
                    <span class="hide-menu"> Content <span class="fa arrow"></span>
                    <span class="label label-rouded label-custom pull-right" id="contentNumber">0</span>
                  </a>
                      <ul class="nav nav-second-level">



                      </ul>
                  </li>
                  <li>
                    <a href="/content" class="waves-effect"><i data-icon="&#xe006;" class="linea-icon linea-basic fa-fw"></i>
                      <span class="hide-menu">Analytics</span>
                    </a>
                  </li>
                  <li>
                    <a href="/transactions" class="waves-effect"><i data-icon="&#xe011;" class="linea-icon linea-basic fa-fw"></i>
                      <span class="hide-menu">Transactions</span>
                    </a>
                  </li>
                  <li>
                    <a href="/a-settings" class="waves-effect"><i data-icon="P" class="linea-icon linea-basic fa-fw"></i>
                      <span class="hide-menu">Settings</span>
                    </a>
                  </li>
                  <!-- <li> <a href="#" class="waves-effect"><i data-icon="7" class="linea-icon linea-basic fa-fw"></i> <span class="hide-menu">Icons<span class="fa arrow"></span></span></a> -->
                      <!-- <ul class="nav nav-second-level">

                      </ul>
                  </li> -->

                  <li>
                    <a href="login.html" class="waves-effect"><i class="icon-logout fa-fw"></i>
                      <span class="hide-menu">Log out</span>
                    </a>
                  </li>

              </ul>
          </div>
      </div>
      <!-- Page Content -->
      <div id="page-wrapper">
          <div class="container-fluid">
              <div class="row bg-title">
                  <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
                      <ol class="breadcrumb" style="float: left;">
                          <!-- <li><a href="#">Dashboard</a></li> -->
                          <li class="active">Settings</li>
                      </ol>
                  </div>
              </div>
              <!-- /.row -->



              <div class="col-md-12">
                <div class="col-md-6 col-lg-6 col-sm-6 col-xs-12">
                    <div class="row">
                        <div class="col-md-12">

                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                  <div class="bg-theme-dark m-b-15">
                      <div class="row weather p-20">
                          <div class="col-md-12 col-xs-6 col-lg-12 col-sm-6">
                              <h3>&nbsp;</h3>
                              <h1>My Ethereum Address </h1><h2 id="myAddress"></h2><button class="btn btn-sm btn-primary" onclick="editEthAddress()">edit</button>


                          </div>


                      </div>
                      <div class="row weather p-20" id="editEth">
                        <div class="col-md-12 col-xs-6 col-lg-12 col-sm-6">
                          <p class="text-white">
                             Please double check address before submission
                          </p></p>
                          <input class="form-control" placeholder="My Ethereum Address" id="myEthAddress"/>
                          <!-- <button onclick="submitEthAddress()" class="btn btn-warning">Submit</button> -->
                        </div>
                      </div>

                  </div>
                    <div class="bg-theme m-b-15">
                        <div id="myCarouse2" class="carousel vcarousel slide p-20">
                            <!-- Carousel items -->
                            <div class="carousel-inner ">
                                <div class="active item" id="outerEl">
                                    <h3 class="text-white">Please enter your<span class="font-bold"> intererests</span>, what you love, what you buy, what you want.</h3>
                                    <h5 class="text-white">Enter as many as you can<span class="font-bold"> every bit helps</span>, and makes you more valuable!</h5>

                                    <!-- <div class="twi-user"><img src="../sources/images/hritik.jpg" alt="user" class="img-circle img-responsive pull-left"> -->
                                        <input class="form-control" id="tag"/><hr />
                                        <br />



                                </div>
                                <!-- <div class="item">
                                    <h3 class="text-white">My Acting blown <span class="font-bold">Your Mind</span> and you also laugh at the moment</h3>
                                    <div class="twi-user"><img src="../sources/images/genu.jpg" alt="user" class="img-circle img-responsive pull-left">
                                        <h4 class="text-white m-b-0">Govinda</h4>
                                        <p class="text-white">Actor</p>
                                    </div>
                                </div>
                                <div class="item">
                                    <h3 class="text-white">My Acting blown <span class="font-bold">Your Mind</span> and you also laugh at the moment</h3>
                                    <div class="twi-user"><img src="../sources/images/ritesh.jpg" alt="user" class="img-circle img-responsive pull-left">
                                        <h4 class="text-white m-b-0">Govinda</h4>
                                        <p class="text-white">Actor</p>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                    </div>


                </div>
              </div>

          </div>
          <footer class="footer text-center"> 2017 &copy; PIES NETWORK </footer>

        </div>


  </div>

  <div>
    <section class="loaderSection" style="background: white">
        <div class="loader" >
          <div class="box"></div>
          <div class="hill"></div>
        </div>
    </section>
  </div>

</body>
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>

<!-- jQuery -->
    <script src="../sources/js/jquery.min.js"></script>
    <script src="../sources/js/tether.min.js"></script>
    <script src="../sources/js/bootstrap.min.js"></script>
    <script src="../sources/js/bootstrap-extension.min.js"></script>
    <script src="../sources/js/sidebar-nav.min.js"></script>
    <script src="../sources/js/jquery.slimscroll.js"></script>
    <script src="../sources/js/waves.js"></script>
    <script src="../sources/js/jquery.waypoints.min.js"></script>
    <script src="../sources/js/jquery.counterup.min.js"></script>
    <script src="../sources/js/raphael-min.js"></script>
    <script src="../sources/js/morris.js"></script>
    <script src="../sources/js/custom.min.js"></script>
    <script src="../sources/js/jquery.sparkline.min.js"></script>
    <script src="../sources/js/dashboard1.js"></script>
    <script src="../sources/js/jquery.charts-sparkline.js"></script>
    <script src="../sources/js/jquery.toast.js"></script>
    <script src="../sources/js/jQuery.style.switcher.js"></script>








<script type="text/javascript">
  $(document).ready(function() {
  // console.log("js script online")
  var loadTime = Math.floor((Math.random() * 3000) + 500);
  //////loader
  $('.main-container').css("display", "none");
  // $('#successMessage').hide();
  setTimeout(function(){
    $('.loader').hide();
    $('.loaderSection').hide();
    $('.main-container').css("display", "initial")
  }, loadTime);
    $.toast({
        heading: 'Welcome to Pies',
        text: 'Loading your pecies now!',
        position: 'top-right',
        loaderBg: '#ff6849',
        icon: 'info',
        hideAfter: loadTime,
        stack: 6
    })
  });
</script>


<script>
var config = {
  apiKey: "AIzaSyBNyW7vjQSK2Gbrh4Mzox6G-uAG4gK1rgE",
  authDomain: "adspace-9fe5c.firebaseapp.com",
  databaseURL: "https://adspace-9fe5c.firebaseio.com",
  projectId: "adspace-9fe5c",
  storageBucket: "",
  messagingSenderId: "129227170241"
};

firebase.initializeApp(config);
var ref = firebase.database().ref('queue/tasks');
var userObject, tagBox;

var tagAmmount = document.getElementById('tagAmmount');
var tagProgress = document.getElementById('tagProgress');
// var statusState = true;
firebase.auth().onAuthStateChanged(function(user) {
  if(user){
    userObject = user;
    checkState(userObject);

    // asyncWait();
    // console.log(user)
    document.getElementById('userImage').src = user.photoURL;
    document.getElementById('userName').innerHTML = user.displayName;

    // writeUserData(u)

  }else{
    window.location = '/';

  }
})

function checkState(user){
  // console.log('checking State', user)
  var userRef = firebase.database().ref('usertype/' + user.uid);
  userRef.on('value', function(snapshot){
    // console.log(snapshot.val())
    var userStatus = snapshot.val().type;
    if(userStatus){
      // console.log(userStatus)
      if(userStatus == '99'){
        return;
      }else if(userStatus == '10'){
        window.location = '/v-settings';
        userRef.off();

      }else{
        window.location = '/';
        userRef.off();

      }
    }else if(!statusState && userStatus){
      // window.location = '/';
      // userRef.off();
      return;

    }else {
      window.location = '/';
      userRef.off();
    }
  })
}



function addTag(){
  var inputEl = document.getElementById('tag')
  // var tag =
  // console.log(tag, userObject)
  var tempValue = inputEl.value;
  inputEl.value = '';
  var tagsRef = firebase.database().ref('tags/' + userObject.uid + '/');
  if(typeof tempValue === "string"){
    tempValue = tempValue.toLowerCase();
    tagsRef.push({"data": tempValue}).then(function(){
      loadTags();
      tempValue = null;
    });
    tagsRef.off();

  }
}

function Onload(){
  document.getElementById('editEth').style.display = "none";

  loadTags();
  setTimeout(function(){
    loadBalance();

  }, 1000)
  tagBox = document.getElementById('tagsBox');
  document.getElementById("tag").addEventListener("keyup", function(event) {
      event.preventDefault();
      if (event.keyCode == 13) {
          addTag();

      }

  });
  document.getElementById("myEthAddress").addEventListener("keyup", function(event) {
      event.preventDefault();
      if (event.keyCode == 13) {
          submitEthAddress();

      }

  });

}

function loadTags(){
  // console.log("wtf its hitting")
 var tagsArray = [];

 if(document.getElementById('tagsBox')){
   document.getElementById('tagsBox').outerHTML = "";

 }
  // console.log("loading Tags")
  var tagsRef = firebase.database().ref('user/' + userObject.uid + '/tags');
  tagsRef.on('value', function(snapshot){
    if(snapshot.val()){
      var tags = snapshot.val();
      for(var k in tags){
        tagsArray.push(tags[k]);
        // console.log(tagsArray)
      }
      var tagsListAmmount = tagsArray.length;
      tagAmmount.innerHTML = tagsListAmmount;
      if(tagsListAmmount > 100){
        var progress = 100;
      }else{
        var progress = tagsListAmmount;
      }
      progress = progress.toString();
      tagProgress.style.width = progress + '%';
      if(tagsListAmmount > 0){
        for(var i = 0; i < tagsListAmmount; i++){
          var outerEl = document.getElementById('outerEl')
          var idInfo = 'tagData' + i.toString();
          var tagData = document.createElement('div')
          tagData.setAttribute('id', 'tagsBox');
          outerEl.appendChild(tagData);
          var tagBox = document.getElementById('tagsBox');
          var tagEl = document.createElement('span');
          var space = document.createElement('div');
          var button = document.createElement('button');
          tagBox.style.display = "inline-flex"
          tagBox.className = "col-md-12"
          button.className = 'btn delTag';
          button.setAttribute('onclick', 'deleteAt(' + i + ')')
          button.innerHTML = 'delete';
          space.innerHTML = '&nbsp';
          tagEl.className =  'indvTag'
          tagEl.style.color = 'black';
          tagEl.setAttribute('id', idInfo);
          tagEl.innerHTML = tagsArray[i].data;
          tagBox.appendChild(tagEl);
          tagEl.appendChild(button)
          tagBox.appendChild(space)
        }
        tagsRef.off();

      }
    }
  })
}

function deleteAt(index){
  // console.log(index);
  tagsRef = firebase.database().ref('user/' + userObject.uid + '/tags/');
  tagsRef.on('value', function(snapshot){
    var count = 0
    for(k in snapshot.val()){
      if(count === index){
        // console.log(k)
        tagsRef.off();

        removeItem(k);
        // console.log("removed tag " + k, "count is " + count)
        // count += 1;

      }
      count += 1;

    }
  })
}

function removeItem(k){
  var dataRef =  firebase.database().ref('user/' + userObject.uid + '/tags/' + k );
  dataRef.set({"data": null}).then(function(err, res){
    dataRef.off
    loadTags();

  });

}

function editEthAddress(){
  if(document.getElementById('editEth').style.display == "none"){
    document.getElementById('editEth').style.display = "block";
  }else{
    document.getElementById('editEth').style.display = "none";
  }
}

function submitEthAddress(){
  var ethAddress = document.getElementById('myEthAddress');
  // var testAccount = '0x541E8E0b0F25f799F941932dDcB93bB83d254E64'
  // testAccount = testAccount.split('');
  console.log(ethAddress.value.length)
  if(ethAddress.value.length > 41 && ethAddress.value.length < 43){
    // console.log(ethAddress.value)
    firebase.database().ref('queue/myEthAddress/tasks').push({"ethAddress": ethAddress.value, "userId": userObject.uid});
  }
}

function loadBalance(ethAddress){
  var userRef = firebase.database().ref('user/' + userObject.uid);
  var data;
  userRef.on('value', function(snapshot){
    data = snapshot.val();
    if(data.ethAddress){
      firebase.database().ref('queue/myEthBalance/tasks').push({"ethAddress": ethAddress, "userId": userObject.uid});

    }
  })
  if(data.myBalance){
    var balance = numberWithCommas(data.myBalance);
    document.getElementById('balance').innerHTML = 'Balance: ' + balance + ' <i><b>PIES</b></i>';
    document.getElementById('p-completion-number').innerHTML = balance;

    document.getElementById('myAddress').innerHTML = data.ethAddress;
  }
}

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

window.addEventListener('load', function() {

  // Checking if Web3 has been injected by the browser (Mist/MetaMask)
  if (typeof web3 !== 'undefined') {

    // Use the browser's ethereum provider
    var provider = web3.currentProvider

    web3.eth.defaultAccount = web3.eth.accounts[0]
    console.log(web3.eth.accounts[0])
    setTimeout(function(){
      if(web3.eth.accounts[0]){
        loadBalance(web3.eth.accounts[0]);
      }
    }, 1000)


    // console.log(provider)
  } else {
    console.log('No web3? You should consider trying MetaMask!')
  }
  //  startApp()
  setTimeout(function(){
      // const eth = new Eth(web3.currentProvider)
      // const contract = new EthContract(eth)
      // initContract(contract, eth)

  }, 2000)
  //  testTransaction()
})
</script>

</html>
